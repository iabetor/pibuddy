# Proposal: 学习工具集

## 变更概述

添加学习工具集，包括英语学习（单词查询、每日一句、单词测验、生词本）、汉字拼音、古诗词（每日一诗、诗词搜索、诗词接龙/飞花令），通过语音交互帮助用户学习。

## 动机

- **语音学习优势**：语音交互比手机APP更自然，适合碎片化学习
- **文化熏陶**：古诗词是中国传统文化精华，每日一句陶冶情操
- **实用性**：生僻字读音、单词查询是日常高频需求
- **趣味性**：诗词接龙、飞花令增加学习乐趣
- **离线可用**：拼音功能使用本地库，无需网络

## 详细设计

### 功能模块

| 模块 | 功能 | 数据来源 | 难度 |
|------|------|---------|------|
| **英语学习** | 单词查询 | 有道词典 API | ⭐ |
| | 每日一句 | 金山词霸 API | ⭐ |
| | 单词测验 | 本地词库 | ⭐⭐ |
| | 生词本 | 本地存储 | ⭐ |
| **汉字拼音** | 汉字转拼音 | go-pinyin 本地库 | ⭐ |
| **古诗词** | 每日一诗 | 诗词六六六 API | ⭐⭐ |
| | 诗词搜索 | 诗词六六六 API | ⭐⭐ |
| | 诗词接龙 | 本地+API | ⭐⭐⭐ |
| | 飞花令 | 本地+API | ⭐⭐⭐ |

### 使用示例

#### 英语学习

```
用户: "hello 是什么意思"
助手: "hello，你好，英式发音 /həˈləʊ/，美式发音 /həˈloʊ/"
      [播放发音]

用户: "每日一句"
助手: "Today's quote: The only way to do great work is to love what you do.
      成就一番伟业的唯一途径就是热爱自己的事业。"

用户: "来个单词测验"
助手: "请听题：abandon 是什么意思？"
用户: "放弃"
助手: "正确！abandon 意思是放弃、抛弃。"

用户: "把 apple 加入生词本"
助手: "已将 apple 加入生词本"

用户: "复习生词本"
助手: "你的生词本有 5 个单词：apple, banana, computer..."
```

#### 汉字拼音

```
用户: "龘 字怎么读"
助手: "龘，读音 dá，意思是龙飞的样子。"

用户: "银行 的拼音是什么"
助手: "银行的拼音是 yín háng。"
```

#### 古诗词

```
用户: "每日一诗"
助手: "《静夜思》李白
      床前明月光，疑是地上霜。
      举头望明月，低头思故乡。"

用户: "春眠不觉晓 的下一句"
助手: "「春眠不觉晓」的下一句是「处处闻啼鸟」，出自孟浩然的《春晓》。"

用户: "关于月亮的诗"
助手: "《静夜思》李白 - 床前明月光...
      《水调歌头》苏轼 - 明月几时有..."

用户: "来玩飞花令，关键字 花"
助手: "我先来：「花落知多少」。请接！"
用户: "花谢花飞花满天"
助手: "好句！我接：「花间一壶酒」。该你了！"
```

### API 依赖

| API | 免费额度 | 用途 |
|-----|---------|------|
| 有道词典 | 无限制 | 单词查询、发音 |
| 金山词霸 | 无限制 | 每日一句 |
| 诗词六六六 | 10万次/月 | 古诗词 |
| go-pinyin | 本地库 | 汉字转拼音 |

### 存储设计

```
{data_dir}/
├── vocabulary.json      # 生词本
├── word_bank.json       # 测验词库（可扩展）
└── poetry_cache.json    # 诗词缓存
```

## 技术方案

详见 [design.md](./design.md)

### 核心组件

1. **EnglishWordTool** - 单词查询（有道词典）
2. **EnglishDailyTool** - 每日一句（金山词霸）
3. **EnglishQuizTool** - 单词测验（本地词库）
4. **VocabularyTool** - 生词本（本地存储）
5. **PinyinTool** - 汉字转拼音（go-pinyin）
6. **PoetryDailyTool** - 每日一诗
7. **PoetrySearchTool** - 诗词搜索
8. **PoetryGameTool** - 诗词接龙/飞花令

## 配置

```yaml
tools:
  learning:
    enabled: true
    english:
      enabled: true
      # 有道词典无需 key
    poetry:
      enabled: true
      api_key: "${PIBUDDY_POETRY_KEY}"  # 诗词六六六 API Key（可选，免费版无需）
    pinyin:
      enabled: true  # 本地库，无需配置
```

## 实现任务

详见 [tasks.md](./tasks.md)

## 影响范围

| 文件 | 变更 |
|------|------|
| `internal/tools/english.go` | 新增 |
| `internal/tools/pinyin.go` | 新增 |
| `internal/tools/poetry.go` | 新增 |
| `internal/tools/vocabulary_store.go` | 新增 |
| `internal/config/config.go` | 添加配置 |
| `internal/pipeline/pipeline.go` | 注册工具 |
| `configs/pibuddy.yaml` | 添加配置 |
| `go.mod` | 添加 go-pinyin 依赖 |

## 风险评估

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| API 调用失败 | 中 | 降级提示，缓存结果 |
| 生词本数据丢失 | 低 | 自动备份 |
| 诗词接龙 AI 答不上 | 低 | 使用 API 搜索备选 |
| API 配额用尽 | 低 | 本地缓存常用诗词 |

## 后续扩展

- [ ] 英语单词发音评测
- [ ] 古诗词背诵模式
- [ ] 成语接龙
- [ ] 多语言学习（日语、韩语）
- [ ] 学习进度统计
