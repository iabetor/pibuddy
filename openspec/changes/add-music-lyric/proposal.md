# Proposal: 音乐歌词显示

## 变更概述

添加歌词获取和显示功能，支持在播放音乐时同步显示歌词。后续可扩展为树莓派外接屏幕显示，打造完整的音乐播放器体验。

## 动机

- **沉浸式体验**：边听边看歌词，更好地理解歌曲内容
- **树莓派扩展**：为后续外接屏幕提供基础能力
- **多端显示**：Web UI 可在手机/电脑/树莓派浏览器上显示

## 功能范围

| 阶段 | 功能 | 说明 |
|------|------|------|
| 阶段 1 | 歌词获取 | 从 QQ 音乐/网易云音乐 API 获取歌词 |
| 阶段 1 | 歌词解析 | 解析 LRC 格式，提取时间戳和文本 |
| 阶段 2 | Web UI 显示 | HTTP API + 前端页面显示歌词 |
| 阶段 3 | 树莓派集成 | 外接屏幕显示（LCD/OLED/HDMI 显示屏） |

## 使用示例

```
[播放《晴天》]
用户: "显示歌词"
助手: "正在显示《晴天》的歌词"

[歌词同步显示]
00:15  故事的小黄花
00:18  从出生那年就飘着
00:22  童年的荡秋千
...
```

## 技术方案

详见 [design.md](./design.md)

### 核心组件

1. **Lyric 结构** - 歌词数据模型（时间戳 + 文本行）
2. **LRC 解析器** - 解析标准 LRC 格式
3. **Provider 扩展** - 在音乐 Provider 接口添加 GetLyric 方法
4. **HTTP API** - `/api/lyric` 端点返回当前歌词

### 歌词 API

| 平台 | 接口 | 返回格式 |
|------|------|---------|
| QQ 音乐 | `/lyric?songmid=xxx` | LRC 格式 |
| 网易云音乐 | `/lyric?id=xxx` | JSON 格式 |

## 实现任务

详见 [tasks.md](./tasks.md)

## 影响范围

| 文件 | 变更 |
|------|------|
| `internal/music/provider.go` | 添加 GetLyric 接口 |
| `internal/music/lyric.go` | 新增，LRC 解析器 |
| `internal/music/qqmusic.go` | 实现 GetLyric |
| `internal/music/netease.go` | 实现 GetLyric |
| `internal/pipeline/pipeline.go` | 集成歌词功能 |

## 风险评估

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 歌词接口限流 | 中 | 本地缓存已获取的歌词 |
| 歌词格式不标准 | 低 | 兼容多种 LRC 变体 |
| 无歌词歌曲 | 低 | 返回空结果，提示无歌词 |

## 后续扩展

- [ ] 歌词翻译显示
- [ ] 歌词滚动动画
- [ ] 树莓派 LCD/OLED 显示
- [ ] 电子墨水屏显示（低功耗）
