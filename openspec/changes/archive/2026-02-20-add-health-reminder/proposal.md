# Proposal: 健康提醒功能

## 变更概述

添加健康提醒功能，包括喝水提醒、久坐提醒、吃药提醒，通过语音播报帮助用户养成健康习惯。

## 动机

- **使用场景频繁**：健康管理是日常高频需求
- **语音优势**：语音提醒比手机通知更直接有效
- **用户粘性**：定时提醒增加用户与助手互动频率
- **健康价值**：帮助用户养成喝水、活动、按时服药的好习惯

## 详细设计

### 功能列表

| 功能 | 说明 | 默认间隔 | 可自定义 |
|------|------|---------|---------|
| **喝水提醒** | 定时提醒喝水 | 2 小时 | ✅ |
| **久坐提醒** | 提醒起身活动 | 1 小时 | ✅ |
| **吃药提醒** | 定时提醒服药 | 用户自定义时间点 | ✅ |

### 核心特性

1. **间隔型提醒**（喝水/久坐）
   - 用户设置间隔时间
   - 从开启时刻开始计时
   - 到时间后 TTS 播报

2. **时间点提醒**（吃药）
   - 用户指定每日时间点
   - 如 "每天 8 点和 20 点"
   - 同一时间点每天只提醒一次

3. **静音时段**
   - 默认 23:00 - 07:00
   - 静音期间不播报提醒
   - 可自定义

### 使用示例

```
用户: "提醒我每两个小时喝一次水"
助手: "已开启喝水提醒，每2小时提醒一次"

用户: "开启久坐提醒"
助手: "已开启久坐提醒，每1小时提醒你起来活动一下"

用户: "设置吃药提醒，每天早上8点和晚上8点吃降压药"
助手: "已设置降压药提醒，每天08:00和20:00会提醒你服药"

用户: "关闭喝水提醒"
助手: "喝水提醒已关闭"

用户: "健康提醒状态"
助手: "当前健康提醒：喝水提醒(每2小时)、久坐提醒(每1小时)、降压药(08:00/20:00)"
```

### 提醒文案（随机）

**喝水提醒**：
- "该喝水了，身体需要水分补充"
- "喝杯水吧，保持健康好习惯"
- "记得喝水哦，多喝水对身体好"

**久坐提醒**：
- "坐太久了，起来活动一下吧"
- "该起来走走了，久坐对身体不好"
- "站起来活动一下，放松放松"

**吃药提醒**：
- "该吃{药品名}了，别忘了"
- "提醒你服用{药品名}"
- "{药品名}时间到了"

## 技术方案

详见 [design.md](./design.md)

### 核心组件

1. **HealthStore** - 存储提醒配置和状态
2. **HealthTool** - LLM 工具接口
3. **HealthChecker** - 定时检查并触发提醒

### 存储位置

`{data_dir}/health_reminders.json`

## 配置

```yaml
tools:
  health:
    enabled: true
    water_interval: 120        # 默认喝水间隔（分钟）
    exercise_interval: 60      # 默认久坐间隔（分钟）
    quiet_hours:
      start: "23:00"           # 静音开始时间
      end: "07:00"             # 静音结束时间
```

## 实现任务

详见 [tasks.md](./tasks.md)

## 影响范围

| 文件 | 变更 |
|------|------|
| `internal/tools/health.go` | 新增 |
| `internal/tools/health_store.go` | 新增 |
| `internal/config/config.go` | 添加配置 |
| `internal/pipeline/pipeline.go` | 注册工具和检查器 |
| `configs/pibuddy.yaml` | 添加配置 |

## 风险评估

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 频繁提醒打扰用户 | 中 | 静音时段、可关闭 |
| 存储文件损坏 | 低 | 自动重建 |
| 系统重启后丢失状态 | 中 | 持久化到文件 |

## 后续扩展

- [ ] 智能感知用户状态（通过麦克风检测是否在家）
- [ ] 与日程联动（开会时自动暂停）
- [ ] 健康数据统计（每周喝了多少次水）
- [ ] 多人模式（声纹识别不同用户的提醒）
